# ğŸ—ºï¸ Inpick BACKEND

AI ê¸°ë°˜ **ì—¬í–‰ ì¼ì • ìƒì„± ë° ì¶”ì²œ ì‹œìŠ¤í…œ**ì˜ ë°±ì—”ë“œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.  
ì‚¬ìš©ìì˜ ì—¬í–‰ì§€, ë™í–‰ì, í…Œë§ˆ, ìœ„ì¹˜ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê°œì¸í™”ëœ ì¼ì •ì„ ìƒì„±í•˜ê³   
ì½˜í…ì¸  ê¸°ë°˜ ì¶”ì²œ, í˜‘ì—… í•„í„°ë§, ì‹œí€€ìŠ¤ ê¸°ë°˜ Next-POI, RAG(Vector DB)ë¥¼ í™œìš©í•œ ì¥ì†Œ ì¶”ì²œì„ ì œê³µí•©ë‹ˆë‹¤.

---

## ğŸš€ ì£¼ìš” ê¸°ëŠ¥

- ğŸ” **ì†Œì…œ ë¡œê·¸ì¸** â€“ Google / Naver / Kakao OAuth ì¸ì¦
- ğŸ§­ **ì—¬í–‰ ì¼ì • ê´€ë¦¬** â€“ ì¼ì • ìƒì„±, ìˆ˜ì •, ì¡°íšŒ, ì‚­ì œ
- ğŸï¸ **ì¶”ì²œ ì‹œìŠ¤í…œ**
  - ì½˜í…ì¸  ê¸°ë°˜ ì¶”ì²œ (CBF)
  - í˜‘ì—… í•„í„°ë§ (CF)
  - ì‹œí€€ìŠ¤ ê¸°ë°˜ ì¶”ì²œ (GRU4Rec, SASRec)
  - RAG ê¸°ë°˜ ì¥ì†Œ ê²€ìƒ‰ (FAISS)
- ğŸ§‘â€ğŸ’¼ **ê´€ë¦¬ì í˜ì´ì§€** â€“ ì‚¬ìš©ì ê´€ë¦¬, ë¡œê·¸ ê´€ë¦¬, ì¹´í…Œê³ ë¦¬ ê´€ë¦¬
- ğŸ“Š **í™œë™ ë¡œê·¸** â€“ ëª¨ë“  ì£¼ìš” ì´ë²¤íŠ¸ ë¡œê¹…

---

## ğŸ§© ê¸°ìˆ  ìŠ¤íƒ

| ë¶„ë¥˜                 | ê¸°ìˆ                              |
| -------------------- | -------------------------------- |
| **Language**         | Python                           |
| **Framework**        | FastAPI                          |
| **Database**         | PostgreSQL, MongoDB              |
| **Vector DB**        | FAISS                            |
| **Machine Learning** | PyTorch, Implicit (ALS)          |
| **LLM/AI**           | OpenAI, Claude (via LangChain)   |
| **Auth**             | OAuth 2.0 (Google, Naver, Kakao) |
| **Map API**          | NCP Map, TMAP API                |
| **Infra**            | Docker, Jenkins, Gunicorn        |
| **Env**              | Conda (`environment.yml`)        |

---

## ğŸ“ ë””ë ‰í† ë¦¬ êµ¬ì¡°
```
app/
â”œâ”€ api/
â”‚ â”œâ”€ endpoint/ # ì£¼ìš” API ì—”ë“œí¬ì¸íŠ¸
â”‚ â”‚ â”œâ”€ auth.py # ë¡œê·¸ì¸ / ì½œë°±
â”‚ â”‚ â”œâ”€ itinerary.py # ì¼ì • ê´€ë¦¬
â”‚ â”‚ â”œâ”€ recommendation.py # ì¶”ì²œ ê¸°ëŠ¥
â”‚ â”‚ â”œâ”€ place.py, region.py, map.py
â”‚ â”‚ â””â”€ manage.py # ê´€ë¦¬ì ê¸°ëŠ¥
â”‚ â””â”€ routers.py # ë¼ìš°í„° ë¬¶ìŒ
â”œâ”€ auth/
â”‚ â”œâ”€ base.py # OAuth ì¶”ìƒ í´ë˜ìŠ¤
â”‚ â”œâ”€ dependencies.py # ì„¸ì…˜ ì¸ì¦ ì˜ì¡´ì„±
â”‚ â”œâ”€ google.py, naver.py, kakao.py
â”œâ”€ services/
â”‚ â”œâ”€ activity_log_service.py # í™œë™ ë¡œê·¸
â”‚ â”œâ”€ generate_itinerary_service.py # ì¼ì • ìƒì„± (ëª¨ë¸ë³„)
â”‚ â”œâ”€ itinerary_service.py # ì¼ì • CRUD
â”‚ â”œâ”€ map_path_service.py # ê²½ë¡œ íƒìƒ‰
â”‚ â”œâ”€ session_service.py # ì„¸ì…˜ ê´€ë¦¬
â”‚ â”œâ”€ user_service.py # ì‚¬ìš©ì ê´€ë¦¬
â”‚ â””â”€ log_service.py # ë¡œê¹…
â”œâ”€ repositories/
â”‚ â”œâ”€ accommodationdb.py # ìˆ™ì†Œ DB ì ‘ê·¼
â”‚ â”œâ”€ categorydb.py # ì¹´í…Œê³ ë¦¬ DB ì ‘ê·¼
â”‚ â”œâ”€ placedb.py # ì¥ì†Œ DB ì ‘ê·¼
â”‚ â”œâ”€ regiondb.py # ì§€ì—­ DB ì ‘ê·¼
â”‚ â””â”€ userdb.py # ì‚¬ìš©ì DB ì ‘ê·¼
â”œâ”€ contentmodel/ # ì½˜í…ì¸  ê¸°ë°˜ ì¶”ì²œ ëª¨ë“ˆ
â”œâ”€ core/ # í™˜ê²½ì„¤ì • ë° ë¡œê¹…
â”œâ”€ db/ # DB ì—°ê²° (Postgres, Mongo)
â”œâ”€ middlewares/ # ë¡œê¹… ë¯¸ë“¤ì›¨ì–´
â”œâ”€ ml/ # ML ëª¨ë¸ (ALS, GRU4Rec, SASRec ë“±)
â”œâ”€ models/ # SQLAlchemy ORM
â”œâ”€ rag/ # RAG + FAISS ë²¡í„° ê²€ìƒ‰
â”œâ”€ schemas/ # Pydantic ìŠ¤í‚¤ë§ˆ ì •ì˜
â””â”€ main.py # FastAPI ì§„ì…ì 

deploy/
â”œâ”€ dockerfile
â””â”€ jenkinsfile

environment.yml
package.json
README.md
```

---

## ğŸ§  ì‹œìŠ¤í…œ êµ¬ì„±

1ï¸âƒ£ ì¸ì¦ í”Œë¡œìš°  
ì‚¬ìš©ì â†’ /auth/{provider}/login  
â†’ OAuth Provider ì¸ì¦  
â†’ /auth/{provider}/callback  
â†’ ì‚¬ìš©ì ì •ë³´ ê²€ì¦  
â†’ **MongoDB ì„¸ì…˜ ìƒì„± (TTL: 1800ì´ˆ)**  
â†’ app_user í…Œì´ë¸” ë“±ë¡/ê°±ì‹   
â†’ **ì¿ í‚¤ ê¸°ë°˜ ì„¸ì…˜ ê´€ë¦¬**

**ì„¸ì…˜ ì¬í™œì„±í™”**: ë§¤ ìš”ì²­ë§ˆë‹¤ ìë™ ê°±ì‹  (UserLogMiddleware)
**ë¡œê·¸ì•„ì›ƒ**: GET /auth/logout (ì„¸ì…˜ ì‚­ì œ)
**ê³„ì • ì‚­ì œ**: DELETE /auth/user (soft delete)

2ï¸âƒ£ ì¶”ì²œ ì‹œìŠ¤í…œ êµ¬ì„±  
| ë°©ì‹ | ê²½ë¡œ | ì„¤ëª… |
|------|------|------|
| CBF | app/contentmodel/content_based_recommendation_service.py | ì¹´í…Œê³ ë¦¬, í…Œë§ˆ, ì„¤ëª… ê¸°ë°˜ ì½”ì‚¬ì¸ ìœ ì‚¬ë„ |
| CF (ALS) | app/ml/collaborativeFiltering/main.py | ì‚¬ìš©ìâ€“ì•„ì´í…œ í–‰ë ¬ ë¶„í•´ |
| Next-POI (GRU4Rec / SASRec) | app/ml/next_poi_gru4rec.py, app/ml/next_poi_sas_rec.py | ì‹œí€€ìŠ¤ ê¸°ë°˜ ë‹¤ìŒ ì¥ì†Œ ì˜ˆì¸¡ |
| RAG | app/rag/faiss_store/ | ìœ„ì¹˜Â·í…Œë§ˆÂ·ë™í–‰ì ì¡°ê±´ìœ¼ë¡œ ë²¡í„° ê²€ìƒ‰ |

---

## âš™ï¸ ì‹¤í–‰ ë°©ë²•

1ï¸âƒ£ í™˜ê²½ êµ¬ì„±  
conda env create -f environment.yml  
conda activate inpick-backend

2ï¸âƒ£ í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (.env ì˜ˆì‹œ)  
DATABASE_URL=postgresql+psycopg2://USER:PASS@HOST:PORT/DBNAME  
MONGO_URI=mongodb://USER:PASS@HOST:PORT/DBNAME

GOOGLE_CLIENT_ID=...  
GOOGLE_CLIENT_SECRET=...  
NAVER_CLIENT_ID=...  
NAVER_CLIENT_SECRET=...  
KAKAO_CLIENT_ID=...  
KAKAO_CLIENT_SECRET=...

OAUTH_REDIRECT_BASE=https://your.domain/auth/callback  
APP_ENV=local  
LOG_LEVEL=INFO

ì‹¤ì œ í‚¤ëª…ì€ app/core/config.py ì°¸ê³ 

3ï¸âƒ£ ì„œë²„ ì‹¤í–‰  
uvicorn app.main:app --reload --port 8000

Docs: http://localhost:8000/docs

---

## ğŸ§ª API ì˜ˆì‹œ

ğŸ“ ì¥ì†Œ CBF ì¶”ì²œ ì˜ˆì‹œ  
curl -X GET "http://localhost:8000/recommendation/places?address=ì œì£¼&suitables[]=ìì—°&categorys[]=ê´€ê´‘&center_location[]=33.4&center_location[]=126.5"

ğŸ“ ì¥ì†Œ ALS ì¶”ì²œ ì˜ˆì‹œ  
curl -X GET "http://localhost:8000/recommendation/places?address=ì œì£¼&suitables[]=ìì—°&categorys[]=ê´€ê´‘&center_location[]=33.4&center_location[]=126.5"

ğŸ§­ ì¼ì • ìƒì„± ì˜ˆì‹œ (Next-POI, SASRec, RAG í¬í•¨)
curl -X POST http://localhost:8000/itinerary/generate \
 -H "Content-Type: application/json" \
 -d '{
"model_name": "ë§ì¶¤í˜• ì¼ì • ì¶”ì²œ", // ë˜ëŠ” "ì‹¤ì‹œê°„ ê´€ì‹¬ ê¸°ë°˜ ì¶”ì²œ" / "GPT ì¶”ì²œ"
"base_itinerary": {...}
}'

ğŸ“‹ ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë¸ ëª©ë¡
curl -X GET http://localhost:8000/itinerary/models

---

## ğŸ³ Docker ì‹¤í–‰

docker build -t inpick-backend:latest -f deploy/dockerfile .  
docker run -p 8000:8000 --env-file .env inpick-backend:latest

---

## ğŸ”„ CI/CD (Jenkins)

deploy/jenkinsfile ê¸°ë°˜ íŒŒì´í”„ë¼ì¸  
Build â†’ Test â†’ Dockerize â†’ Deploy

í¬íŠ¸ ì¶©ëŒ, í—¬ìŠ¤ì²´í¬, í™˜ê²½ë³€ìˆ˜ ìë™ ë¡œë“œ í¬í•¨

---

## ğŸ§± ë°ì´í„° ëª¨ë¸ ìš”ì•½

| í…Œì´ë¸”              | ì„¤ëª…                                     |
| ------------------- | ---------------------------------------- |
| app_user            | ìœ ì € ê³„ì •, ì†Œì…œ ë¡œê·¸ì¸, soft delete ì§€ì› |
| place               | ì¥ì†Œ(ê´€ê´‘ì§€, ìŒì‹ì , ì¹´í˜ ë“±)            |
| accommodation       | ìˆ™ì†Œ ì •ë³´                                |
| itinerary           | ì—¬í–‰ ì¼ì •(ì‹œì‘/ì¢…ë£Œì¼, êµ¬ì„±ì›, í…Œë§ˆ ë“±)  |
| itinerary_item      | ì¼ì • ë‚´ ì„¸ë¶€ ì¥ì†Œ                        |
| category            | ì¥ì†Œ ì¹´í…Œê³ ë¦¬                            |
| **region**          | **ì§€ì—­ ì •ë³´ (ìœ„ê²½ë„ í¬í•¨)**              |
| **place_category**  | **ì¥ì†Œ-ì¹´í…Œê³ ë¦¬ ì—°ê²° (ë‹¤ëŒ€ë‹¤)**          |
| **place_registrar** | **ì‚¬ìš©ì ë“±ë¡ ì¥ì†Œ (ë‹¤ëŒ€ë‹¤)**            |

---

## ğŸ“‹ ì²´í¬ë¦¬ìŠ¤íŠ¸

âœ… .env í™˜ê²½ ë³€ìˆ˜ ì„¸íŒ… ì™„ë£Œ  
âœ… DB ì—°ê²° í™•ì¸  
âœ… FAISS ì¸ë±ìŠ¤ íŒŒì¼ ì¡´ì¬ (app/rag/faiss_store/)  
âœ… PyTorch ëª¨ë¸ ë¡œë“œ ê°€ëŠ¥ (app/ml/artifacts/\*.pt)  
âœ… OAuth Redirect URI ì¼ì¹˜  
âœ… ë¡œê·¸ ê¸°ë¡ ì •ìƒ ì‘ë™

---

## ğŸªª ë¼ì´ì„ ìŠ¤

ë³¸ í”„ë¡œì íŠ¸ì˜ ì €ì‘ê¶Œì€ **AICC6-Maenggler-3rd íŒ€**ì— ìˆìœ¼ë©°,  
ìƒìš© ë° ë°°í¬ ì •ì±…ì€ ë³„ë„ ë¼ì´ì„ ìŠ¤ ì¡°í•­ì„ ë”°ë¦…ë‹ˆë‹¤.

---

## ğŸ‘¥ íŒ€ ì •ë³´

**AICC6-Maenggler-3rd Team**  
AI ê¸°ë°˜ ì—¬í–‰ ì¼ì • ìƒì„± ì„œë¹„ìŠ¤ â€œInpickâ€
